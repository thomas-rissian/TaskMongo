<div class="board-container">
  <!-- Header fixe -->
  <header class="board-header">
    <div class="header-content">
      <h1>Kanban Board</h1>
      <p class="task-count">{{ tasks.length }} t√¢che(s)</p>
    </div>
    <button class="btn-create" (click)="openEditModal()">+ Cr√©er une t√¢che</button>
  </header>

  <!-- Barre de filtre -->
  <app-task-filter (filterChange)="applyFilters($event)"></app-task-filter>

  <!-- Contenu principal scrollable -->
  <main class="board-content">
    <!-- Loader -->
    <div *ngIf="loading" class="loader-container">
      <app-loader></app-loader>
    </div>

    <!-- Pas de r√©sultats -->
    <div *ngIf="!loading && tasks.length === 0" class="no-results">
      <p>Aucune t√¢che trouv√©e</p>
    </div>

    <!-- Board avec colonnes -->
    <div class="board-columns" *ngIf="!loading && tasks.length > 0">
      <!-- Colonne pour chaque statut -->
      <div *ngFor="let status of statuses" class="column-wrapper">
        <h2 class="column-header">{{ status }}</h2>
        
        <!-- Zone de drop -->
        <div 
          cdkDropList
          #droppable="cdkDropList"
          [id]="'drop-' + status"
          [cdkDropListData]="getTasksByStatus(status)"
          [cdkDropListConnectedTo]="getConnectedDropListIds()"
          cdkDropListSortingDisabled
          class="drop-zone"
          (cdkDropListDropped)="drop($event, status)">

          <!-- Cartes de t√¢ches -->
          <div 
            *ngFor="let task of getTasksByStatus(status)"
            cdkDrag
            class="task-card"
            (click)="openEditModal(task)">
            
            <div class="task-header">
              <h3>{{ task.titre }}</h3>
              <button class="btn-delete" (click)="removeTask(task); $event.stopPropagation()">√ó</button>
            </div>

            <p class="task-description">{{ task.description }}</p>

            <!-- Priorit√© et Cat√©gorie -->
            <div class="task-meta">
              <span class="priority" [ngClass]="'priority-' + task.priorite">{{ task.priorite }}</span>
              <span *ngIf="task.categorie" class="category">{{ task.categorie }}</span>
            </div>

            <!-- Sous-t√¢ches avec checkboxes -->
            <div class="subtasks" *ngIf="task.sousTaches && task.sousTaches.length">
              <div class="subtasks-header">
                Sous-t√¢ches ({{ getCompletedSubtaskCount(task) }}/{{ task.sousTaches.length }})
              </div>
              <div class="subtask-item" *ngFor="let subtask of task.sousTaches" (click)="$event.stopPropagation()">
                <input 
                  type="checkbox" 
                  [checked]="isSubtaskDone(subtask)"
                  (change)="toggleSubtask(task, subtask._id!, subtask.statut!)"
                  class="subtask-checkbox">
                <span class="subtask-title" [ngClass]="{ 'done': isSubtaskDone(subtask) }">
                  {{ subtask.titre }}
                </span>
              </div>
            </div>

            <!-- Commentaires count -->
            <div class="task-footer" *ngIf="task.commentaires && task.commentaires.length">
              <span class="comment-count">üí¨ {{ task.commentaires.length }}</span>
            </div>
          </div>

          <!-- Placeholder pour drop vide -->
          <div class="drop-placeholder" *ngIf="getTasksByStatus(status).length === 0">
            Aucune t√¢che
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer fixe -->
  <footer class="board-footer">
    <p>&copy; 2024 TaskMongo - Task Management</p>
  </footer>

  <!-- Modal pour √©diter une t√¢che -->
  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content modal-large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>√âditer la t√¢che</h2>
        <button class="modal-close" (click)="closeModal()">√ó</button>
      </div>
      <div class="modal-body">
        <app-task-form 
          [task]="selectedTask || undefined"
          (close)="closeModal()">
        </app-task-form>
      </div>
    </div>
  </div>
</div>

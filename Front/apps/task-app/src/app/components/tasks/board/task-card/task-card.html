<div class="bg-white border border-gray-200 rounded-lg p-3 hover:shadow-md transition-shadow shadow-sm">
  <div class="flex justify-between items-start gap-2 mb-2">
    <span class="text-xs font-semibold text-gray-500">
      {{ formatDate(task.dateCreation) }}
    </span>
  </div>

  <div class="flex items-start justify-between mb-2 gap-2">
    <!-- Title: allow shrinking and clamping so it doesn't push the action buttons -->
    <a [routerLink]="['/tasks', task._id]" class="block hover:text-blue-600 flex-1 min-w-0" (click)="$event.stopPropagation()" [attr.title]="task.titre" [attr.aria-label]="task.titre">
      <h3 class="font-semibold text-sm text-gray-900 line-clamp-2 wrap-break-word">{{ task.titre }}</h3>
    </a>

    <!-- Actions: fixed-size group that won't be pushed by the title -->
    <div class="flex items-center gap-2 shrink-0">
      <button
        class="text-xs px-2 py-0.5 rounded hover:bg-gray-100"
        (click)="onEditClick($event)"
        aria-label="Edit task"
      >
        Edit
      </button>
      <button
        class="text-xs px-2 py-0.5 rounded hover:bg-gray-100"
        (click)="onRemoveClick()"
        aria-label="Remove task"
      >
        Supprimer
      </button>
    </div>
  </div>

  @if (task.description) {
    <p class="text-xs text-gray-600 mb-2 line-clamp-3">
      {{ truncateText(task.description, 3) }}
    </p>
  }

  @if (task.priorite) {
    <div class="mb-2">
      <span 
        [ngClass]="getPriorityColor()" 
        class="inline-block px-2 py-1 rounded text-xs font-semibold"
      >
        {{ task.priorite }}
      </span>
    </div>
  }

  @if (task.etiquettes && task.etiquettes.length > 0) {
    <div class="flex flex-wrap gap-1 mb-2">
      @for (label of getVisibleLabels(); track label) {
        <span class="inline-block bg-blue-100 text-blue-700 text-xs px-2 py-0.5 rounded">
          #{{ label }}
        </span>
      }
      @if (getRemainingLabelsCount() > 0) {
        <span class="inline-block bg-gray-200 text-gray-700 text-xs px-2 py-0.5 rounded font-semibold">
          +{{ getRemainingLabelsCount() }}
        </span>
      }
    </div>
  }

  @if (task.sousTaches && task.sousTaches.length > 0) {
    <div class="mt-2 pt-2 border-t border-gray-200">
      <button
        type="button"
        class="flex items-center gap-1 text-xs font-semibold text-gray-700 hover:bg-gray-100 px-2 py-1 rounded transition-colors w-full"
        (click)="toggleSubtasks(); $event.stopPropagation()"
      >
        <span class="text-xs">{{ showSubtasks ? '▼' : '▶' }}</span>
        <span>{{ getSubtaskProgress().completed }}/{{ getSubtaskProgress().total }} sous-tâches</span>
      </button>
      @if (showSubtasks) {
        <app-subtask-list
          [subtasks]="task.sousTaches"
          class="mt-2"
        ></app-subtask-list>
      }
    </div>
  }
</div>
